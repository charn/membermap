!function(e,t,r){"use strict";r.Icon.Default.imagePath="images/";var a=r.map("map",{center:[64.9514,27.6023],zoom:5});new r.tileLayer("http://{s}.tile.stamen.com/toner-lite/{z}/{x}/{y}.png",{minZoom:0,maxZoom:18,attribution:'<a href="http://maps.stamen.com">Map tiles</a> by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.'}).addTo(a);var o=!0,n=1,i=e.$,s=function(e){var t=-(1/0);for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];a>t&&(t=a)}return t},u=function(e){for(var t={},r=e.length,a=0;r>a;++a){var o=e[a],n=o.residence.toLowerCase().trim();t[n]?t[n]+=1:t[n]=1}return{locations:t,totalMembers:r}},p=function(e,t){for(var r=t.features,a=r.length,o={},n=0;a>n;++n)for(var i=r[n],s=i.properties.text,u=s[0],p=s.length,m=0;p>m;++m){var f=s[m].toLowerCase().trim();e[f]&&(o[u]?o[u]+=e[f]:o[u]=e[f])}return o},m=function(e){return JSON.parse(JSON.stringify(e))},f=function(e,t){var r,a=m(t),i=a.features.length,u=s(e),p=Math.log(u)+n;for(r=0;i>r;++r){var f=a.features[r].properties.text[0],c=e[f];c?(a.features[r].properties.amount=c,a.features[r].properties.relativeAmount=o?(Math.log(c)+n)/p:c/u):(a.features[r].properties.amount=0,a.features[r].properties.relativeAmount=0)}return a},c=function(e,t,a){return r.geoJson(t,{style:function(e){return{stroke:!1,color:"black",weight:1,opacity:1,fill:!0,fillColor:"red",fillOpacity:e.properties.relativeAmount}},onEachFeature:function(e,t){t.bindPopup(e.properties.text[0]+": "+e.properties.amount+"/"+a)}})};i.getJSON("./images/located_members.json").then(function(e){var t=u(e),r=t.locations,o=t.totalMembers;i.getJSON("./images/kuntarajat.geojson").then(function(e){var t=p(r,e),n=f(t,e),i=c(a,n,o);i.addTo(a)})})}(window,document,L);